"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var S=0;S<e.length;S++){var r=e[S];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,S,r){return S&&t(e.prototype,S),r&&t(e,r),e}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,S=Array(t.length);e<t.length;e++)S[e]=t[e];return S}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Storage=function(){function t(e,S){if(_classCallCheck(this,t),this.STORAGE_SUBSCRIBERS=[],void 0!=e&&null!=e)if("object"!==(void 0===e?"undefined":_typeof(e))||Array.isArray(e)||e.NOT_STORAGE)this.STORAGE_VALUE=e;else for(var r in e)this[r]=new t(e[r]);else this.STORAGE_VALUE=void 0!=S?S:null;return!0}return _createClass(t,[{key:"storage_update",value:function(e){if(e.STORAGE_VALUE||"object"!==(void 0===e?"undefined":_typeof(e))||Array.isArray(e))this.STORAGE_VALUE=e.STORAGE_VALUE;else{delete this.STORAGE_VALUE;for(var S in this)"STORAGE_VALUE"!=S&&"STORAGE_SUBSCRIBERS"!=S&&void 0===e[S]&&delete this[S];for(var r in e)"STORAGE_VALUE"!=r&&"STORAGE_SUBSCRIBERS"!=r&&(void 0!==this[r]&&"function"==typeof this[r].storage_update&&this[r].__proto__===this.__proto__?this[r].storage_update(e[r]):this[r]=new t(e[r]))}e&&e.STORAGE_SUBSCRIBERS&&(this.STORAGE_SUBSCRIBERS=e.STORAGE_SUBSCRIBERS)}},{key:"update",value:function(t){this.storage_update(t),this.callAllSubscribers()}},{key:"callAllSubscribers",value:function(){for(var t=0;t<this.STORAGE_SUBSCRIBERS.length;t++)this.STORAGE_SUBSCRIBERS[t].callback(this.STORAGE_VALUE);for(var e in this)"STORAGE_VALUE"!=e&&"STORAGE_SUBSCRIBERS"!=e&&this[e].callAllSubscribers()}},{key:"set",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.STORAGE_VALUE=e;for(var S=function(e){"function"==typeof t.STORAGE_SUBSCRIBERS[e].callback?(t.STORAGE_SUBSCRIBERS[e].delayed?setTimeout(function(){t.STORAGE_SUBSCRIBERS[e].callback(t.STORAGE_VALUE)},0):t.STORAGE_SUBSCRIBERS[e].callback(t.STORAGE_VALUE),e++):t.STORAGE_SUBSCRIBERS.splice(e,1),r=e},r=0;r<this.STORAGE_SUBSCRIBERS.length;)S(r);return!0}},{key:"get",value:function(){return this.STORAGE_VALUE}},{key:"subscribe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=!1;if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))for(var r=0;r<this.STORAGE_SUBSCRIBERS.length;r++)if(this.STORAGE_SUBSCRIBERS[r]===t){S=!0;break}return S||this.STORAGE_SUBSCRIBERS.push({delayed:e,callback:t}),this.STORAGE_VALUE}},{key:"sub",value:function(t,e,S){return this.subscribe(t,e,S)}},{key:"unsubscribe",value:function(t){for(var e=0;e<this.STORAGE_SUBSCRIBERS.length;e++)if(this.STORAGE_SUBSCRIBERS[e].callback===t){this.STORAGE_SUBSCRIBERS.splice(e,1);break}return this.STORAGE_VALUE}},{key:"unsub",value:function(t){return this.unsubscribe(t)}},{key:"add",value:function(e,S){if("STORAGE_VALUE"==e||"STORAGE_SUBSCRIBERS"==e)throw"Resticted name '"+e+"'";return this[e]=new t(null,S),!0}},{key:"clone",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],new t);e&&(S.STORAGE_SUBSCRIBERS=[].concat(_toConsumableArray(this.STORAGE_SUBSCRIBERS)));for(var r in this)"STORAGE_VALUE"!=r&&"STORAGE_SUBSCRIBERS"!=r?S[r]=this[r].clone(e,S):("STORAGE_SUBSCRIBERS"!=r||e)&&(S[r]=this[r]);return S}}]),t}();exports.default=Storage;